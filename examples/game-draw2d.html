<html>
<head>
  <!-- Use require1k for module loading without having to bundle -->
  <script src="../require1k.js"></script>
  <script>
    var config = {"paragliders": [
      {x:100, y:100, z:200},
    ]};

    // Asynchronously loads commonjs module and calls callback
    R("../built/game-engine/terrain", function (err, Terrain) {
      if (err) {console.error(err.statusText); return;}
      R("../built/game-engine/engine", function (err, Engine) {
        if (err) {console.error(err.statusText); return;}
        R("../built/render/view2d", function (err, view2d) {
          if (err) {console.error(err.statusText); return;}

          var img = new Image();
          img.style.display = "none";

          img.onload = function() {
            var t = new Terrain(img);
            var e = new Engine(t, config);
            var hmcanv = document.getElementById("heightmap");
            hmcanv.width = img.width; hmcanv.height = img.height;
            var hmv = new view2d.HeightmapView(e, hmcanv);
            var t = 0;
            var f = function(timestamp) {
              if (t===0) t = timestamp;
              //console.log(timestamp);
              //e.paragliders[0].pos.x++;
              //e.paragliders[0].pos.y++;
              e.update((timestamp-t)/1000);
              hmv.update();
              requestAnimationFrame(f);
            };
            requestAnimationFrame(f);
          }
          img.src = "../obj/sceneries/test1/test1.png";
        });
      });
    });
  </script>
</head>
<body>
  <canvas id="heightmap"></canvas>
</body>
</html>
